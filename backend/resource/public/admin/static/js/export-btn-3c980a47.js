import{i as e}from"./index.umd.min-b551c2d1.js";import{F as t}from"./file-saver-26c4fb83.js";import{u as r,w as o,S as a}from"./xlsx-c1873084.js";import{a as n}from"./element-plus-cc31d756.js";import{d as i,b as s,N as l,W as u}from"./@vue.runtime-core-6173334e.js";import{r as c,i as m}from"./@vue.reactivity-54707199.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./@vue.runtime-dom-532828a1.js";import"./@vue.shared-0cc4c744.js";import"./lodash-es-fd5b777b.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./@element-plus.icons-vue-2c9f4d7f.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./dayjs-f8876307.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";function p(){if(!(this instanceof p))return new p;this.SheetNames=[],this.Sheets={}}function f(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),o=0;o!=e.length;++o)r[o]=255&e.charCodeAt(o);return t}function d({multiHeader:e=[],header:n,data:i,filename:s,merges:l=[],autoWidth:u=!0,bookType:c="xlsx"}={}){s=s||"excel-list",(i=[...i]).unshift(n);for(let t=e.length-1;t>-1;t--)i.unshift(e[t]);var m="SheetJS",d=new p,h=function(e,t){for(var o,n={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},s=0;s!=e.length;++s)for(var l=0;l!=e[s].length;++l){i.s.r>s&&(i.s.r=s),i.s.c>l&&(i.s.c=l),i.e.r<s&&(i.e.r=s),i.e.c<l&&(i.e.c=l);var u={v:e[s][l]};if(null!=u.v){var c=r.encode_cell({c:l,r:s});"number"==typeof u.v?u.t="n":"boolean"==typeof u.v?u.t="b":u.v instanceof Date?(u.t="n",u.z=a._table[14],u.v=(o=u.v,(Date.parse(o)-new Date(Date.UTC(1899,11,30)))/864e5)):u.t="s",n[c]=u}}return i.s.c<1e7&&(n["!ref"]=r.encode_range(i)),n}(i);if(l.length>0&&(h["!merges"]||(h["!merges"]=[]),l.forEach((e=>{h["!merges"].push(r.decode_range(e))}))),u){const e=i.map((e=>e.map((e=>null==e?{wch:10}:e.toString().charCodeAt(0)>255?{wch:2*e.toString().length}:{wch:e.toString().length}))));let t=e[0];for(let r=1;r<e.length;r++)for(let o=0;o<e[r].length;o++)t[o].wch<e[r][o].wch&&(t[o].wch=e[r][o].wch);h["!cols"]=t}d.SheetNames.push(m),d.Sheets[m]=h;var v=o(d,{bookType:c,bookSST:!1,type:"binary"});t.saveAs(new Blob([f(v)],{type:"application/octet-stream"}),`${s}.${c}`)}const h=i({name:"cl-export-btn",props:{filename:[Function,String],autoWidth:{type:Boolean,default:!0},bookType:{type:String,default:"xlsx"},header:Array,columns:{type:Array,required:!0},data:[Function,Array],maxExportLimit:Number},setup(t){const r=c(!1),o=e.useCrud();async function a(){if("function"==typeof t.filename)return await(null==t?void 0:t.filename());{const{year:e,month:r,day:o,hour:a,minu:n,sec:i}=function(){const e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minu:e.getMinutes(),sec:e.getSeconds()}}();return t.filename||`报表（${e}-${r}-${o} ${a}_${n}_${i}）`}}async function i(){if(!t.columns)return;r.value=!0;const e=t.columns.filter((e=>!(!0===e.hidden||["selection","expand","index"].includes(e.type)||e.filterExport||e["filter-export"]))),i=e.map((e=>e.prop)).filter(Boolean),s=await async function(e,t){return e.filter((e=>!e.hidden&&t.includes(e.prop))).map((e=>e.label))}(e,i);let l=await("function"==typeof t.data?t.data():t.data?t.data:null==(c=o.value)?void 0:c.service.page({...null==(u=o.value)?void 0:u.paramsReplace(o.value.params),maxExportLimit:t.maxExportLimit,isExport:!0}).then((e=>e.list.map((e=>{for(const r in e){const o=t.columns.find((e=>e.prop==r));if(o&&(o.formatter&&(e=o.formatter(e)),o.dict)){const t=(m(o.dict)?o.dict.value:o.dict).find((t=>t.value==e[r]));t&&(e[r]=t.label)}}return e})))).catch((e=>(n.error(e.message),null))));var u,c;if(!l)return void(r.value=!1);const p=await a();l=l.map((e=>i.map((t=>e[t])))),d({header:s,data:l,filename:p,autoWidth:t.autoWidth,bookType:t.bookType}),r.value=!1}return()=>s(u("el-button"),{loading:r.value,onClick:i},{default:()=>[s("slot",null,[l("导出")])]})}});export{h as default};
