import{i as e}from"./index.umd.min-b551c2d1.js";import{d as l}from"./browser-2d7b7d5f.js";import"./vue-echarts-bffdbdc9.js";import{a,b as t}from"./element-plus-cc31d756.js";import"./store-acbd10e3.js";import{a as n,r}from"./index-dd9d36be.js";import{u as o}from"./index-5926ad47.js";import{u as s}from"./component-5f09aecc.js";import{d as i,p,e as d,W as u,o as m,c,b as v,_ as f,a as b,J as h,M as y,K as k,N as _,I as j,al as g,ak as w,U as x,F as I}from"./@vue.runtime-core-6173334e.js";import{r as C,u as N}from"./@vue.reactivity-54707199.js";import{_ as W}from"./_plugin-vue_export-helper-1b428a4d.js";import{v as V,w as z}from"./@vue.runtime-dom-532828a1.js";import{Q as q,R as M,E as B}from"./@element-plus.icons-vue-2c9f4d7f.js";import{r as F}from"./lodash-es-fd5b777b.js";import{p as T,L as U}from"./@vue.shared-0cc4c744.js";import"./axios-bb93cf32.js";import"./vue-21f38777.js";import"./monaco-editor-89e755bd.js";import"./nprogress-27d9be10.js";import"./vue-router-25454f45.js";import"./@vueuse.core-cb7ad152.js";import"./@vueuse.shared-feb01f08.js";import"./pinia-77f7f468.js";import"./vue-demi-71ba0ef2.js";import"./mockjs-005b47e8.js";import"./resize-detector-2312ef2b.js";import"./echarts-e550b62f.js";import"./tslib-a4e99503.js";import"./zrender-f72fb7be.js";import"./@popperjs.core-b696b006.js";import"./@ctrl.tinycolor-a951068a.js";import"./dayjs-f8876307.js";import"./async-validator-ff95bfc9.js";import"./memoize-one-63ab667a.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui.dom-92665be4.js";import"./@floating-ui.core-c1b3624a.js";const A={class:"dept-select"},$=i({name:"dept-select"}),L=W(i({...$,props:{modelValue:[Array,Number,String],multiple:Boolean,checkStrictly:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(e,{emit:l}){const t=e,{service:r}=o(),s=C(),i=C();function f(e){t.multiple||l("update:modelValue",e)}function b(e,{checkedKeys:a}){t.multiple&&l("update:modelValue",a)}return p((()=>t.modelValue),(e=>{s.value=e}),{immediate:!0}),d((()=>{r.base.sys.department.list().then((e=>{i.value=n(e)})).catch((e=>{i.value=[],a.error(e.message)}))})),(l,a)=>{const t=u("el-tree-select");return m(),c("div",A,[v(t,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),"node-key":"id",data:i.value,props:{label:"name",value:"id",children:"children"},multiple:e.multiple,"check-strictly":e.checkStrictly,"show-checkbox":e.multiple,"default-expand-all":"",onChange:f,onCheck:b},null,8,["modelValue","data","multiple","check-strictly","show-checkbox"])])}}}),[["__scopeId","data-v-6be59c9b"]]),S={class:"dept-move"},G=i({name:"dept-move"}),R=i({...G,setup(l,{expose:n}){const{service:r}=o(),s=e.useForm(),i=e.useCrud();return n({open:async function(e){var l;null==(l=s.value)||l.open({title:"部门转移",width:"500px",props:{labelWidth:"80px"},items:[{label:"选择部门",prop:"departmentId",component:{vm:L}}],on:{submit(l,{done:n,close:o}){if(!l.departmentId)return a.warning("请选择部门"),n();t.confirm("转移到新部门，是否继续？","提示",{type:"warning"}).then((()=>{r.base.sys.user.move({...l,userIds:e}).then((()=>{var e;a.success("转移成功"),null==(e=i.value)||e.refresh(),o()})).catch((e=>{a.error(e.message),n()}))})).catch((()=>null))}}})}}),(e,l)=>{const a=u("cl-form");return m(),c("div",S,[v(a,{ref_key:"Form",ref:s},null,512)])}}}),E={class:"dept-tree"},K={class:"dept-tree__header"},O=(e=>(g("data-v-fdef8766"),e=e(),w(),e))((()=>b("div",null,"组织架构",-1))),D={class:"dept-tree__op"},H={class:"no"},J=["onContextmenu"],Q={class:"dept-tree__node"},P=["onClick"],X=["onClick"],Y=i({name:"dept-tree"}),Z=W(i({...Y,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["list-change","refresh","user-add"],setup(i,{emit:p}){const g=i,{service:w,browser:x}=o(),{ViewGroup:I}=s(),W=e.useForm(),A=C([]),$=C(!1),L=C(!1);function S({data:e}){return e.parentId}function G(e,l){return l.data.parentId}async function R(){$.value=!0,L.value=!1,await w.base.sys.department.list().then((e=>{var l;A.value=n(e),(null==(l=I.value)?void 0:l.selected)||Y()})),$.value=!1}function Y(e){var l,a;if(e||(e=A.value[0]),e){const t=e.children?r(e.children).map((e=>e.id)):[];t.unshift(e.id),p("refresh",{page:1,departmentIds:t}),null==(l=I.value)||l.select(e),null==(a=I.value)||a.setTitle(`成员列表（${e.name}）`)}}function Z(e){var l;const t=e.id?"update":"add";null==(l=W.value)||l.open({title:"编辑部门",width:"550px",props:{labelWidth:"100px"},items:[{label:"部门名称",prop:"name",component:{name:"el-input"},required:!0},{label:"上级部门",prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:"排序",prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(l,{done:n,close:r}){w.base.sys.department[t]({id:e.id,parentId:e.parentId,name:l.name,orderNum:l.orderNum}).then((()=>{a.success(`新增部门 “${l.name}” 成功`),r(),R()})).catch((e=>{a.error(e.message),n()}))}}})}function ee(e){e?t.confirm("部门架构已发生改变，是否保存？","提示",{type:"warning"}).then((async()=>{const e=[];!function l(a,t){a.forEach((a=>{a.parentId=t,e.push(a),a.children&&F(a.children)&&l(a.children,a.id)}))}(A.value,null),await w.base.sys.department.order(e.map(((e,l)=>({id:e.id,parentId:e.parentId,orderNum:l})))).then((()=>{a.success("更新排序成功")})).catch((e=>{a.error(e.message)})),R(),L.value=!1})).catch((()=>null)):R()}function le(n,r,o){r||(r=A.value[0]||{});const s=w.base.sys.department.permission;e.ContextMenu.open(n,{list:[{label:"新增",hidden:o&&o.level>=g.level||!l(s.add),callback(e){Z({name:"",parentName:r.name,parentId:r.id}),e()}},{label:"编辑",hidden:!l(s.update),callback(e){Z(r),e()}},{label:"删除",hidden:!r.parentId||!l(s.delete),callback(e){!function(e){async function l(l){await w.base.sys.department.delete({ids:[e.id],deleteUser:l}).then((()=>{var n,r;(null==(r=null==(n=I.value)?void 0:n.selected)?void 0:r.id)==e.id&&Y(),l?a.success("删除成功"):t.confirm(`“${e.name}” 部门的用户已成功转移到 “${e.parentName}” 部门。`,"删除成功")})),R()}t.confirm(`该操作会删除 “${e.name}” 部门的所有用户，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"保留用户",distinguishCancelAndClose:!0}).then((()=>{l(!0)})).catch((e=>{"cancel"==e&&l(!1)}))}(r),e()}},{label:"新增成员",hidden:!l(s.add),callback(e){p("user-add",r),e()}}]})}return d((function(){R()})),(e,l)=>{const a=u("el-icon"),t=u("el-tooltip"),n=u("el-button"),r=u("el-tree"),o=u("el-scrollbar"),s=u("cl-form"),p=f("loading");return m(),c("div",E,[b("div",K,[O,b("ul",D,[b("li",{onClick:l[0]||(l[0]=e=>R())},[v(t,{content:"刷新"},{default:h((()=>[v(a,null,{default:h((()=>[v(N(q))])),_:1})])),_:1})]),i.drag&&!N(x).isMini?(m(),c("li",{key:0,onClick:l[1]||(l[1]=e=>L.value=!0)},[v(t,{content:"拖动排序"},{default:h((()=>[v(a,null,{default:h((()=>[v(N(M))])),_:1})])),_:1})])):y("",!0),k(b("li",H,[v(n,{onClick:l[2]||(l[2]=e=>ee(!0)),size:"small"},{default:h((()=>[_("保存")])),_:1}),v(n,{onClick:l[3]||(l[3]=e=>ee(!1)),size:"small"},{default:h((()=>[_("取消")])),_:1})],512),[[V,L.value]])])]),b("div",{class:"dept-tree__container",onContextmenu:z(le,["stop","prevent"])},[v(o,null,{default:h((()=>[k((m(),j(r,{"node-key":"id","default-expand-all":"",data:A.value,props:{label:"name"},draggable:L.value,"allow-drag":S,"allow-drop":G,"expand-on-click-node":!1,onNodeContextmenu:le},{default:h((({node:e,data:l})=>{var t,n;return[b("div",Q,[b("span",{class:T(["dept-tree__node-label",{"is-active":l.id==(null==(n=null==(t=N(I))?void 0:t.selected)?void 0:n.id)}]),onClick:e=>Y(l)},U(e.label),11,P),N(x).isMini?(m(),c("span",{key:0,class:"dept-tree__node-icon",onClick:a=>le(a,l,e)},[v(a,null,{default:h((()=>[v(N(B))])),_:1})],8,X)):y("",!0)])]})),_:1},8,["data","draggable"])),[[p,$.value]])])),_:1})],40,J),v(s,{ref_key:"Form",ref:W},null,512)])}}}),[["__scopeId","data-v-fdef8766"]]),ee=i({name:"sys-user"}),le=i({...ee,setup(l){const{service:a,refs:t,setRefs:n}=o(),{ViewGroup:r}=s(),i=e.useCrud({service:a.base.sys.user}),p=e.useTable({columns:[{type:"selection",width:60},{prop:"headImg",label:"头像",component:{name:"cl-avatar"}},{prop:"username",label:"用户名",minWidth:150},{prop:"name",label:"姓名",minWidth:150},{prop:"nickName",label:"昵称",minWidth:150},{prop:"departmentName",label:"部门名称",minWidth:150},{prop:"roleName",label:"角色",headerAlign:"center",minWidth:120},{prop:"status",label:"状态",minWidth:120,component:{name:"cl-switch"}},{prop:"phone",label:"手机号码",minWidth:150},{prop:"remark",label:"备注",minWidth:150},{prop:"createTime",label:"创建时间",sortable:"desc",minWidth:160},{type:"op",buttons:["slot-btn","edit","delete"],width:240}]}),d=e.useUpsert({dialog:{width:"800px"},items:[{prop:"headImg",label:"头像",component:{name:"cl-upload",props:{text:"选择头像"}}},{prop:"name",label:"姓名",span:12,required:!0,component:{name:"el-input"}},{prop:"nickName",label:"昵称",required:!0,span:12,component:{name:"el-input"}},{prop:"username",label:"用户名",required:!0,span:12,component:{name:"el-input"}},()=>{var e;return{prop:"password",label:"密码",span:12,required:"add"==(null==(e=d.value)?void 0:e.mode),component:{name:"el-input",props:{type:"password"}},rules:[{min:6,max:16,message:"密码长度在 6 到 16 个字符"}]}},{prop:"roleIdList",label:"角色",value:[],required:!0,component:{name:"el-select",options:[],props:{multiple:!0,"multiple-limit":3}}},{prop:"phone",label:"手机号码",span:12,component:{name:"el-input"}},{prop:"email",label:"邮箱",span:12,component:{name:"el-input"}},{prop:"remark",label:"备注",component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:"状态",value:1,component:{name:"el-radio-group",options:[{label:"开启",value:1},{label:"关闭",value:0}]}}],onSubmit(e,{next:l}){var a,t;l({...e,departmentId:null==(t=null==(a=r.value)?void 0:a.selected)?void 0:t.id})},async onOpen(){a.base.sys.role.list().then((e=>{var l;null==(l=d.value)||l.setOptions("roleIdList",e.map((e=>({label:e.name||"",value:e.id}))))}))}});function b(e){var l;null==(l=i.value)||l.refresh(e)}function g({id:e}){var l;null==(l=i.value)||l.rowAppend({departmentId:e})}async function w(e){var l;let a=[];a=e?[e.id]:(null==(l=p.value)?void 0:l.selection.map((e=>e.id)))||[],t.deptMove.open(a)}return(e,l)=>{const t=u("cl-refresh-btn"),o=u("cl-add-btn"),s=u("cl-multi-delete-btn"),C=u("el-button"),W=u("cl-flex1"),V=u("cl-search-key"),z=u("cl-row"),q=u("el-tag"),M=u("cl-table"),B=u("cl-pagination"),F=u("cl-upsert"),T=u("cl-crud"),A=u("cl-view-group"),$=f("permission");return m(),j(A,{ref_key:"ViewGroup",ref:r},{left:h((()=>[v(Z,{onRefresh:b,onUserAdd:g})])),right:h((()=>[v(T,{ref_key:"Crud",ref:i},{default:h((()=>[v(z,null,{default:h((()=>{var e;return[v(t),v(o),v(s),k((m(),j(C,{type:"success",disabled:0==(null==(e=N(p))?void 0:e.selection.length),onClick:l[0]||(l[0]=e=>w())},{default:h((()=>[_("转移")])),_:1},8,["disabled"])),[[$,N(a).base.sys.user.permission.move]]),v(W),v(V,{placeholder:"搜索用户名、姓名"})]})),_:1}),v(z,null,{default:h((()=>[v(M,{ref_key:"Table",ref:p},{"column-roleName":h((({scope:e})=>[e.row.roleName?(m(!0),c(I,{key:0},x(e.row.roleName.split(","),((e,l)=>(m(),j(q,{key:l,"disable-transitions":"",size:"small",effect:"dark",style:{margin:"2px"}},{default:h((()=>[_(U(e),1)])),_:2},1024)))),128)):y("",!0)])),"slot-btn":h((({scope:e})=>[k((m(),j(C,{text:"",bg:"",onClick:l=>w(e.row)},{default:h((()=>[_("转移")])),_:2},1032,["onClick"])),[[$,N(a).base.sys.user.permission.move]])])),_:1},512)])),_:1}),v(z,null,{default:h((()=>[v(W),v(B)])),_:1}),v(F,{ref_key:"Upsert",ref:d},null,512),v(R,{ref:N(n)("deptMove")},null,512)])),_:1},512)])),_:1},512)}}});export{le as default};
